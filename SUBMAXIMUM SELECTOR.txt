@0
# A PROVIDER
MOV UP ACC
MOV ACC RIGHT
MOV ACC RIGHT
MOV ACC RIGHT

@1
# SEND Q,P DOWN
START: # STEP 1
  MOV UP ACC
  SUB LEFT
  JGZ GZ # B - A
LZ: # P=A, Q=B
  ADD LEFT
  MOV ACC DOWN
  MOV LEFT DOWN
  JMP START
GZ: # P=B, Q=A
  MOV LEFT DOWN
  ADD LEFT
  MOV ACC DOWN

@2
# C PROVIDER
MOV UP ACC
MOV ACC RIGHT
MOV ACC RIGHT
MOV ACC RIGHT

@3
# SEND S,R DOWN
START: # STEP 2
  MOV UP ACC
  SUB LEFT
  JGZ GZ # D - C
LZ: # R=C, S=D
  ADD LEFT
  MOV ACC DOWN
  MOV LEFT DOWN
  JMP START
GZ: # R=D, S=C
  MOV LEFT DOWN
  ADD LEFT
  MOV ACC DOWN

@5
# SEND P,S,S DOWN
MOV UP RIGHT  # Q
MOV UP DOWN   # P
MOV RIGHT ACC # S
MOV ACC DOWN  # S
MOV ACC DOWN  # S
MOV ACC DOWN  # S

@6
# Q,S PASSER
# Q START
MOV LEFT ACC
# S START,END
MOV RIGHT LEFT
# Q END
MOV ACC RIGHT

@7
# SEND R,Q,Q DOWN
MOV UP LEFT  # S
MOV UP DOWN  # R
MOV LEFT ACC # Q
MOV ACC DOWN # Q
MOV ACC DOWN # Q

@9
START:
# SEND P RIGHT
  MOV UP ACC
  MOV ACC RIGHT
# STEP 4
  SUB UP
  JGZ P # P - S
S: # MAX2 IS S
  MOV UP RIGHT
  JMP START
P: # MAX2 IS P
  ADD UP
  MOV ACC RIGHT

@10
# STEP 3
START:
  MOV LEFT ACC
  SUB RIGHT
  JGZ RQ # P - R
PS: # MAX2 IN P,S
  MOV RIGHT NIL
  MOV LEFT DOWN
  JMP START
RQ: # MAX2 IN R,Q
  MOV LEFT NIL
  MOV RIGHT DOWN

@11
START:
# SEND R LEFT
  MOV UP ACC
  MOV ACC LEFT
# STEP 5
  SUB UP
  JGZ R # R - Q
Q: # MAX2 IS Q
  MOV UP LEFT
  JMP START
R: # MAX2 IS R
  ADD UP
  MOV ACC LEFT
